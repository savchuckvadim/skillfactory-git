# Ветвление в Git
---

[К cодержанию](Содержание.md)

Предположим, вы работаете над проектом и уже имеете несколько коммитов.

![](https://git-scm.com/book/en/v2/images/basic-branching-1.png)
**Рисунок. Простая история коммитов**

Вы решаете, что теперь вы будете заниматься проблемой #53 из вашей системы отслеживания ошибок. Чтобы создать ветку и сразу переключиться на нее, можно выполнить команду `git checkout` с параметром `-b` :

>$ git checkout -b iss53
>
>Switched to a new branch "iss53"

Это тоже самое что и:
> $ git branch iss53
>
> $ git checkout iss53


![](https://git-scm.com/book/en/v2/images/basic-branching-2.png)

**Рисунок. Создание нового указателя ветки**


Вы работаете над своим сайтом и делаете коммиты. Это приводит к тому, что ветка iss53 движется вперед, так как вы переключились на нее ранее (HEAD указывает на нее).

>$ vim index.html
>
>$ git commit -a -m 'added a new footer [issue 53]'

![](https://git-scm.com/book/en/v2/images/basic-branching-3.png)

**Рисунок. Ветка iss53 двигается вперед**

Тут вы получаете сообщение об обнаружении уязвимости на вашем сайте, которую нужно немедленно устранить. Благодаря Git, не требуется размещать это исправление вместе с тем, что вы сделали в iss53. Вам даже не придется прилагать усилий, чтобы откатить все эти изменения для начала работы над исправлением. Все, что вам нужно — переключиться на ветку `master`.

Но перед тем как сделать это — имейте в виду, что если ваш рабочий каталог либо область подготовленных файлов содержат изменения, не попавшие в коммит и конфликтующие с веткой, на которую вы хотите переключиться, то **Git** не позволит вам переключить ветки. Лучше всего переключаться из чистого рабочего состояния проекта. Есть способы обойти это (спрятать (`stash`) или исправить (`amend`) коммиты). 
Предположим, что вы зафиксировали все свои изменения и можете переключиться на ветку `master`:

> $ git checkout master
>
>Switched to branch 'master'
>

С этого момента ваш рабочий каталог имеет точно такой же вид, какой был перед началом работы над проблемой #53, и вы можете сосредоточиться на работе над исправлением. Важно запомнить: когда вы переключаете ветки, **Git** возвращает состояние рабочего каталога к тому виду, какой он имел в момент последнего коммита в эту ветку. Он добавляет, удаляет и изменяет файлы автоматически, чтобы состояние рабочего каталога соответствовало тому, когда был сделан последний коммит.

Теперь вы можете перейти к написанию исправления. Давайте создадим новую ветку для исправления, в которой будем работать, пока не закончим исправление.

>
> $ git checkout -b hotfix
>
> Switched to a new branch 'hotfix'
>
> $ vim index.html
>
> $ git commit -a -m 'fixed the broken email address'
>
>[hotfix 1fb7853] fixed the broken email address
>
> 1 file changed, 2 insertions(+)

![](https://git-scm.com/book/en/v2/images/basic-branching-4.png)

**Рисунок. Ветка hotfix основана на ветке master**

Вы можете прогнать тесты, чтобы убедиться, что ваше исправление делает именно то, что нужно. И если это так — выполнить слияние ветки `hotfix` с веткой `master` для включения изменений в продукт. Это делается командой `git merge` :

> $ git checkout master
>
> $ git merge hotfix
>

**Git** просто переместил указатель ветки вперед, потому что коммит C4, на который указывает слитая ветка `hotfix`, был прямым потомком коммита C2, на котором вы находились до этого. Другими словами, если коммит сливается с тем, до которого можно добраться двигаясь по истории прямо, **Git** упрощает слияние просто перенося указатель ветки вперед, так как нет расхождений в изменениях. Это называется “fast-forward”.

Теперь ваши изменения включены в коммит, на который указывает ветка master, и исправление можно внедрять.

![](https://git-scm.com/book/en/v2/images/basic-branching-5.png)


**Рисунок. master перемотан до hotfix**

После внедрения вашего архиважного исправления вы готовы вернуться к работе над тем, что были вынуждены отложить. Но сначала нужно удалить ветку `hotfix`, потому что она больше не нужна — ветка `master` указывает на то же самое место. Для удаления ветки выполните команду `git branch` с параметром `-d`:

> $ git branch -d hotfix
>
> Deleted branch hotfix (3a0874c).

Теперь вы можете переключиться обратно на ветку iss53 и продолжить работу над проблемой #53:

> $ git checkout iss53
> 
> $ git commit -a -m 'finished the new footer [issue 53]'

![](https://git-scm.com/book/en/v2/images/basic-branching-6.png)

**Рисунок. Продолжение работы над iss53**
Стоит обратить внимание на то, что все изменения из ветки `hotfix` не включены в вашу ветку iss53. Если их нужно включить, вы можете влить ветку `master` в вашу ветку `iss53` командой `git merge master`, или же вы можете отложить слияние этих изменений до завершения работы, и затем влить ветку iss53 в master.


[Проверить состояние репозитория](gitstatus.md) 

[Слияние и конфликты](gitmerge.md)